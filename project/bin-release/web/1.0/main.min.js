var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),fly;!function(t){var e=function(){function e(){this.layerIndex=0,this.isDestroy=!1,this.indexOf=-1,this.objmgr=t.ObjectManager.inst()}return e.prototype.initBody=function(t){var e=new p2.Body(t);this.body=e},e.prototype.updatePosition=function(e){var i=this;if(void 0===e&&(e=0),this.body){if(this.body.displays.forEach(function(t){t.x=i.body.position[0],t.y=i.body.position[1]}),!t.FlyConfig.DebugMode)return;this.body.sleepState==p2.Body.SLEEPING?this.body.displays[0].alpha=.5:this.body.displays[0].alpha=1}},e.prototype.setGroupAndMask=function(t,e){this.shape&&(this.shape.collisionGroup=t,this.shape.collisionMask=e)},e.prototype.addChild=function(t){this.body.displays||(this.body.displays=[]),this.body.displays.push(t)},e.prototype.onTrigger=function(t){return!1},e.prototype.onContactBegin=function(t){},e.prototype.onContactEnd=function(t){},e.prototype.destroy=function(){this.isDestroy=!0},e}();t.FlyObject=e,__reflect(e.prototype,"fly.FlyObject")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initShape=function(t){var e=new p2.Circle({radius:t});this.shape=e,this.circle=e,this.body.addShape(e),this.initRender(t)},i.prototype.initRender=function(e){var i=t.FlyTools.getBodyTypeColor(this.body.type),o=new egret.Shape;o.graphics.beginFill(i,t.FlyConfig.DebugMode?1:0),o.graphics.drawCircle(0,0,e),o.graphics.endFill(),this.rander=o,this.addChild(o)},i.prototype.changeRenderSize=function(e){var i=t.FlyTools.getBodyTypeColor(this.body.type),o=this.rander;o.graphics.clear(),o.graphics.beginFill(i,t.FlyConfig.DebugMode?1:0),o.graphics.drawCircle(0,0,e),o.graphics.endFill()},i.prototype.setRotation=function(t){this.shape.angle=t,this.rander.rotation=t},i}(t.FlyObject);t.FlyCircle=e,__reflect(e.prototype,"fly.FlyCircle")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initShape=function(t,e){var i=new p2.Box({width:t,height:e});this.shape=i,this.rect=i,this.body.addShape(i),this.initRender(t,e)},i.prototype.initRender=function(e,i){var o=t.FlyTools.getBodyTypeColor(this.body.type),a=new egret.Shape;a.graphics.beginFill(o,t.FlyConfig.DebugMode?1:0),a.graphics.drawRect(-e/2,-i/2,e,i),a.graphics.endFill(),this.rander=a,this.addChild(a)},i.prototype.changeRenderSize=function(e,i){var o=t.FlyTools.getBodyTypeColor(this.body.type),a=this.rander;a.graphics.clear(),a.graphics.beginFill(o,t.FlyConfig.DebugMode?1:0),a.graphics.drawRect(-e/2,-i/2,e,i),a.graphics.endFill()},i.prototype.setRotation=function(t){this.body.displays.forEach(function(e){e.rotation=t})},i}(t.FlyObject);t.FlyRect=e,__reflect(e.prototype,"fly.FlyRect")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.baseScale=t.FlyParam.WeightTrapsBaseScale,r.layerIndex=3,r.x=i+a,r.y=o+a,r.radius=a,r.min=s.min||0,r.max=s.max||999,r.initBody({id:t.FlyConfig.getPropertyId(),mass:s.mass||1,type:s.type||p2.Body.DYNAMIC,fixedRotation:!0,position:[r.x,r.y],damping:s.damping||.7}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.Property,t.ObjectMask.Property),r.initBitmap(s.path),r.updatePosition(),r.setRotation(s.rotation),r}return __extends(i,e),i.prototype.initBitmap=function(t){var e=new egret.MovieClip(this.objmgr.iceFactory.generateMovieClipData("ice"));e.gotoAndPlay("normal",-1),e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.scaleX=this.baseScale*this.radius/e.width,e.scaleY=this.baseScale*this.radius/e.height,this.addChild(e),this._movieClip=e},i.prototype.onTrigger=function(t){var e=this;return this.objmgr.players.forEach(function(i){return i.body.id==t?(e.min<i.body.mass&&i.body.mass<e.max&&(e._movieClip.gotoAndPlay("drop",1),i.died(4),i.movieClip.visible=!1,i.dieMovieClip.visible=!1),!0):void 0}),!0},i}(t.FlyCircle);t.WeightTraps=e,__reflect(e.prototype,"fly.WeightTraps")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.layerIndex=1,r.x=i+a/2,r.y=o+s/2,r.width=a,r.height=s,r.initBody({id:t.FlyConfig.getBlockId(),mass:1,type:p2.Body.STATIC,fixedRotation:!0,position:[r.x,r.y]}),r.initShape(r.width,r.height),r.setGroupAndMask(t.ObjectGroup.Block,t.ObjectMask.Block),r.initBitmap(),r.updatePosition(),r}return __extends(i,e),i.prototype.initBitmap=function(){},i}(t.FlyRect);t.Wall=e,__reflect(e.prototype,"fly.Wall")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s,r){var n=e.call(this)||this;return n.baseScale=t.FlyParam.WeightBlockBaseScale,n.layerIndex=3,n.x=i+a/2,n.y=o+s/2,n.width=a,n.height=s,n.min=r.min||0,n.max=r.max||999,n.initBody({id:t.FlyConfig.getBlockId(),mass:9999,type:p2.Body.DYNAMIC,fixedRotation:!0,position:[n.x,n.y],damping:r.damping||.8}),n.initShape(n.width,n.height),n.setGroupAndMask(t.ObjectGroup.Block,t.ObjectMask.Block),n.initBitmap(r.path),n.updatePosition(),n.setRotation(r.rotation),n}return __extends(i,e),i.prototype.initBitmap=function(e){var i=t.FlyTools.createBitmapByName(e);i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=this.baseScale*this.width/i.width,i.scaleY=this.baseScale*this.height/i.height,this.addChild(i)},i.prototype.onContactBegin=function(t){var e=this;this.objmgr.players.forEach(function(i){if(i.body.id==t){var o=9999;return e.min<i.force&&i.force<e.max&&(o=1),void(e.body.mass!=o&&(e.body.mass=o,e.body.updateMassProperties()))}})},i.prototype.onContactEnd=function(t){this.body.mass=9999,this.body.updateMassProperties()},i}(t.FlyRect);t.WeightBlock=e,__reflect(e.prototype,"fly.WeightBlock")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s,r){var n=e.call(this)||this;return n.baseScale=t.FlyParam.MonsterBaseScale,n._soundName="",n._nowState="stand",n.layerIndex=3,n.x=i+a/2,n.y=o+s/2,n.width=a,n.height=s,n.min=r.min||0,n.max=r.max||999,n.dir=r.dir||1,n._soundName=r.sound||"monster.mp3",n.initBody({id:t.FlyConfig.getBlockId(),mass:9999,type:p2.Body.DYNAMIC,fixedRotation:!0,position:[n.x,n.y],damping:r.damping||.8}),n.initShape(n.width,n.height),n.setGroupAndMask(t.ObjectGroup.Block,t.ObjectMask.Block),n.initBitmap(r.path),n.updatePosition(),n.setRotation(r.rotation),n}return __extends(i,e),i.prototype.initBitmap=function(t){var e=new egret.MovieClip(this.objmgr.monFactory.generateMovieClipData("monsterWall"));e.gotoAndPlay("stand",-1),e.anchorOffsetX=.6*e.width,e.anchorOffsetY=.7*e.height,e.scaleX=this.baseScale*this.dir,e.scaleY=this.baseScale,this.addChild(e),this._movieClip=e,this._movieClip.addEventListener(egret.Event.COMPLETE,this.afterMovieClip,this)},i.prototype.afterMovieClip=function(){this._movieClip.gotoAndPlay("stand",-1),this._nowState="stand"},i.prototype.onContactBegin=function(e){var i=this;this.objmgr.players.forEach(function(o){if(o.body.id!=e);else{var a=9999;if(i.min<o.force&&o.force<i.max&&(a=1),i.body.mass!=a&&(i.body.mass=a,i.body.updateMassProperties()),9999==a&&"stand"==i._nowState)i._movieClip.gotoAndPlay("attack",1),i._nowState="attack";else if(9999==a&&"attack"==i._nowState)if(o.power<t.FlyParam.PlayerStep[0])o.hit([0,0],-t.FlyParam.PlayerStep[0],1);else{var s=t.FlyTools.getDirect(o.body.position,i.body.position),r=t.FlyParam.forceScale;o.hit([s[0]*r,s[1]*r],t.FlyParam.hit_power,1)}}})},i.prototype.onContactEnd=function(t){this.body.mass=9999,this.body.updateMassProperties()},i.prototype.updatePosition=function(i){void 0===i&&(i=0),e.prototype.updatePosition.call(this,i);var o=this.objmgr.scene.player,a=p2.vec2.dist(o.body.position,this.body.position),s=(this.width+this.height)/2;2*s>a?(t.SceneManager.inst().playSound(this._soundName,this),this.dir=o.body.position[0]>=this.body.position[0]?-1:1,this._movieClip.scaleX=this.baseScale*this.dir):t.SceneManager.inst().stopSound(this._soundName,this)},i}(t.FlyRect);t.WeightMonster=e,__reflect(e.prototype,"fly.WeightMonster")}(fly||(fly={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.isLoadRes=!1,e.isLoadThm=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loadUI")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName?(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isLoadRes=!0,this.init()):"loadUI"==t.groupName&&(this.loadingView=new UILoading,this.loadingView.x=this.stage.stageWidth/2-200,this.loadingView.y=this.stage.stageHeight/2,this.loadingView.scaleX=2,this.loadingView.scaleY=2,this.stage.addChild(this.loadingView),RES.loadGroup("preload"))},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.onThemeLoadComplete=function(){this.isLoadThm=!0,this.init()},e.prototype.init=function(){this.isLoadRes&&this.isLoadThm&&(this.stage.removeChild(this.loadingView),this.initGame())},e.prototype.initGame=function(){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause(),console.log("Game2 onPause!")},egret.lifecycle.onResume=function(){egret.ticker.resume(),console.log("Game2 onResume!")};var t=new fly.EnterGameScene;this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var fly;!function(t){var e;!function(t){t[t.None=0]="None",t[t.Rect=1]="Rect",t[t.Circle=2]="Circle"}(e=t.ObjectType||(t.ObjectType={}));var i;!function(t){t[t.None=0]="None",t[t.Block=Math.pow(2,0)]="Block",t[t.Player=Math.pow(2,1)]="Player",t[t.Obstacle=Math.pow(2,2)]="Obstacle",t[t.Property=Math.pow(2,3)]="Property",t[t.AiPlayer=Math.pow(2,4)]="AiPlayer"}(i=t.ObjectGroup||(t.ObjectGroup={}));var o;!function(t){t[t.None=0]="None",t[t.Block=i.Block|i.Player|i.AiPlayer]="Block",t[t.Player=i.Player|i.Block|i.AiPlayer]="Player",t[t.Obstacle=i.Obstacle|i.AiPlayer]="Obstacle",t[t.Property=0]="Property",t[t.AiPlayer=i.AiPlayer|i.Block|i.Player|i.Obstacle]="AiPlayer"}(o=t.ObjectMask||(t.ObjectMask={}));var a=function(){function t(){}return t.getPlayerId=function(){return t.PlayerId++,t.PlayerId>=t.PlayerMaxId&&(t.PlayerId=t.PlayerMinId),t.PlayerId},t.getBlockId=function(){return t.BlockId++,t.BlockId>=t.BlockMaxId&&(t.BlockId=t.BlockMinId),t.BlockId},t.getPropertyId=function(){return t.PropertyId++,t.PropertyId>=t.PropertyMaxId&&(t.PropertyId=t.PropertyMinId),t.PropertyId},t.getObstacleId=function(){return t.ObstacleId++,t.ObstacleId>=t.ObstacleMaxId&&(t.ObstacleId=t.ObstacleMinId),t.ObstacleId},t.getAiPlayerId=function(){return t.AiPlayerId++,t.AiPlayerId>=t.AiPlayerMaxId&&(t.AiPlayerId=t.AiPlayerMinId),t.AiPlayerId},t.isPlayer=function(e){return t.PlayerMinId<=e&&e<t.PlayerMaxId},t.isBlock=function(e){return t.BlockMinId<=e&&e<t.BlockMaxId},t.isProperty=function(e){return t.PropertyMinId<=e&&e<t.PropertyMaxId},t.isObstacle=function(e){return t.ObstacleMinId<=e&&e<t.ObstacleMaxId},t.isAiPlayer=function(e){return t.AiPlayerMinId<=e&&e<t.AiPlayerMaxId},t.reset=function(){t.PlayerId=t.PlayerMinId,t.BlockId=t.BlockMinId,t.PropertyId=t.PropertyMinId,t.ObstacleId=t.ObstacleMinId,t.AiPlayerId=t.AiPlayerMinId},t.DebugMode=!1,t.PlayerMinId=0,t.BlockMinId=1e3,t.PropertyMinId=2e3,t.ObstacleMinId=3e3,t.AiPlayerMinId=4e3,t.PlayerMaxId=1e3,t.BlockMaxId=2e3,t.PropertyMaxId=3e3,t.ObstacleMaxId=4e3,t.AiPlayerMaxId=5e3,t.PlayerId=t.PlayerMinId,t.BlockId=t.BlockMinId,t.PropertyId=t.PropertyMinId,t.ObstacleId=t.ObstacleMinId,t.AiPlayerId=t.AiPlayerMinId,t}();t.FlyConfig=a,__reflect(a.prototype,"fly.FlyConfig");var s=function(){function t(){}return t.LayerScale=.8,t.forceScale=1e3,t.PlayerMaxPower=100,t.PlayerMinPower=0,t.PlayerInitPower=50,t.PlayerInitMass=1,t.PlayerInitForce=100,t.PlayerStep=[30,70,100],t.PlayerVelScale=[.5,.4,.3],t.PlayerTijiScale=[.9,1,1.1],t.PlayerRadiusScale=[.7,1,1.5],t.PlayerMassScale=[10,25,50],t.PlayerForceScale=[.5,1,2],t.PlayerMoviePostfix=["_lean","_normal","_fat"],t.candy_power=10,t.move_power=-3,t.hit_power=-20,t.traps_show_time=4,t.traps_hide_time=4,t.PlayerBaseScale=1,t.CandyBaseScale=2,t.TrapsBaseScale=1,t.MoveBaseScale=1,t.WeightTrapsBaseScale=8,t.PlaneBaseScale=1.5,t.AiBaseScale=1.2,t.WeightBlockBaseScale=1,t.WindBaseScale=2,t.MonsterBaseScale=2,t}();t.FlyParam=s,__reflect(s.prototype,"fly.FlyParam")}(fly||(fly={}));var fly;!function(t){var e=function(){function t(){this._sound=new egret.Sound,this._time=0,this._initFinish=!1}return t.prototype.loadMusic=function(t,e){void 0===e&&(e=0),this.stop(),this._initFinish=!1,this._sound.load(t),this._sound.addEventListener(egret.Event.COMPLETE,this.onLoad,this),this._time=e},t.prototype.loadMusicOnly=function(t){this.stop(),this._initFinish=!1,this._sound.load(t),this._sound.addEventListener(egret.Event.COMPLETE,this.onLoadOnly,this)},t.prototype.play=function(t){void 0===t&&(t=0),this._initFinish&&(this._channel=this._sound.play(0,t),this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this))},t.prototype.stop=function(){this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this),this._channel.stop(),this._channel=null)},t.prototype.onLoad=function(){this._sound.removeEventListener(egret.Event.COMPLETE,this.onLoad,this),this._initFinish=!0,this.play(this._time)},t.prototype.onLoadOnly=function(){this._sound.removeEventListener(egret.Event.COMPLETE,this.onLoad,this),this._initFinish=!0},t.prototype.onComplete=function(){this.stop()},t.prototype.playObject=function(t,e){void 0===e&&(e=0),this.loadMusic("resource/music/"+t,e)},t.prototype.loadObject=function(t){this.loadMusicOnly("resource/music/"+t)},t}();t.FlyMusic=e,__reflect(e.prototype,"fly.FlyMusic")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.baseScale=2,r.layerIndex=1,r.x=i+a,r.y=o+a,r.radius=2*a,r.initBody({id:t.FlyConfig.getBlockId(),mass:s.mass||1,type:s.type||p2.Body.STATIC,fixedRotation:!0,position:[r.x,r.y],damping:s.damping||0}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.Block,t.ObjectMask.Block),r.initBitmap(s.path),r.updatePosition(),r.setRotation(s.rotation),r}return __extends(i,e),i.prototype.initBitmap=function(e){if(null!=e){var i=t.FlyTools.createBitmapByName(e);i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=this.baseScale*this.radius/i.width,i.scaleY=this.baseScale*this.radius/i.height,this.addChild(i)}},i}(t.FlyCircle);t.BlockCircle=e,__reflect(e.prototype,"fly.BlockCircle")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s,r){var n=e.call(this)||this;return n.layerIndex=1,n.x=i+a/2,n.y=o+s/2,n.width=a,n.height=s,n.initBody({id:t.FlyConfig.getBlockId(),mass:r.mass||1,type:r.type||p2.Body.STATIC,fixedRotation:!0,position:[n.x,n.y],damping:r.damping||0}),n.initShape(n.width,n.height),n.setGroupAndMask(t.ObjectGroup.Block,t.ObjectMask.Block),n.initBitmap(r.path),n.updatePosition(),n.setRotation(r.rotation),n}return __extends(i,e),i.prototype.initBitmap=function(e){if(null!=e){var i=t.FlyTools.createBitmapByName(e);i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=this.width/i.width,i.scaleY=this.height/i.height,this.addChild(i)}},i}(t.FlyRect);t.BlockRect=e,__reflect(e.prototype,"fly.BlockRect")}(fly||(fly={}));var fly;!function(t){var e=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.getBodyTypeColor=function(t){return t==p2.Body.STATIC?16711680:t==p2.Body.DYNAMIC?65280:t==p2.Body.KINEMATIC?255:16777215},t.showToast=function(t){var e=new egret.TextField;return e.text=t,e.width=400,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e},t.getDirect=function(t,e){var i=[];return p2.vec2.normalize(i,[t[0]-e[0],t[1]-e[1]]),i},t}();t.FlyTools=e,__reflect(e.prototype,"fly.FlyTools")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.baseScale=t.FlyParam.AiBaseScale,r._soundName="",r._dir=1,r._nowState="front",r.layerIndex=4,r.x=i+a,r.y=o+a,r.radius=a,r.pRadius=s.pRadius||4*a,r.pVelocity=s.pVelocity||t.FlyParam.forceScale/3,r._soundName=s.sound||"dog.mp3",r.initBody({id:t.FlyConfig.getAiPlayerId(),mass:1,type:p2.Body.DYNAMIC,fixedRotation:!0,position:[r.x,r.y],damping:s.damping||.7}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.AiPlayer,t.ObjectMask.AiPlayer),r.initBitmap(s.path),r.updatePosition(),r}return __extends(i,e),i.prototype.initBitmap=function(t){var e=new egret.MovieClip(this.objmgr.dogFactory.generateMovieClipData("dog"));e.gotoAndPlay("front",-1),e.anchorOffsetX=e.width/2,e.anchorOffsetY=.8*e.height,e.scaleX=this.baseScale*this._dir,e.scaleY=this.baseScale,this.addChild(e),this._movieClip=e},i.prototype.destroy=function(){e.prototype.destroy.call(this),t.SceneManager.inst().stopSound(this._soundName,this)},i.prototype.onTrigger=function(t){var e=this;return this.objmgr.players.forEach(function(i){return i.body.id==t?(e._movieClip.gotoAndPlay("attack",1),e.body.velocity=[0,0],i.died(5),!0):void 0}),!0},i.prototype.updatePosition=function(i){void 0===i&&(i=0),e.prototype.updatePosition.call(this,i);var o=this.objmgr.scene.player,a=p2.vec2.dist(o.body.position,this.body.position);if(a<=this.pRadius){var s=[o.body.position[0]-this.body.position[0],o.body.position[1]-this.body.position[1]],r=[];p2.vec2.normalize(r,s);var n=this.pVelocity;this.body.velocity=[r[0]*n,r[1]*n],t.SceneManager.inst().playSound(this._soundName,this)}else this.body.velocity=[0,0],t.SceneManager.inst().stopSound(this._soundName,this);this.updateDir()},i.prototype.updateDir=function(){var t=Math.abs(this.body.velocity[0]),e=Math.abs(this.body.velocity[1]);this.body.velocity[1]<0&&e>t?this.gotoAndPlay("back"):this.body.velocity[1]>0&&e>t?this.gotoAndPlay("front"):this.body.velocity[0]>0&&t>=e?this.gotoAndPlaySide("right",1):this.body.velocity[0]<0&&t>=e&&this.gotoAndPlaySide("right",-1)},i.prototype.gotoAndPlay=function(t){this._nowState!=t&&(this._movieClip.gotoAndPlay(t,-1),this._nowState=t)},i.prototype.gotoAndPlaySide=function(t,e){(this._nowState!=t||this._dir!=e)&&(this._movieClip.gotoAndPlay(t,-1),this._nowState=t,this._dir=e,this._movieClip.scaleX=this.baseScale*this._dir)},i}(t.FlyCircle);t.AiTraps=e,__reflect(e.prototype,"fly.AiTraps")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s,r){var n=e.call(this)||this;return n.source=[],n.target=[],n.baseScale=t.FlyParam.MoveBaseScale,n.layerIndex=3,n.x=i+a/2,n.y=o+s/2,n.width=a,n.height=s,n.tx=r.tx+a/2,n.ty=r.ty+s/2,n.dir=r.dir||1,n.pVelocity=r.pVelocity||200,n.source=[n.x,n.y],n.target=[n.tx,n.ty],n.initBody({id:t.FlyConfig.getObstacleId(),mass:r.mass||1,type:r.type||p2.Body.DYNAMIC,fixedRotation:!0,position:[n.x,n.y],damping:r.damping||.7}),n.initShape(n.width,n.height),n.setGroupAndMask(t.ObjectGroup.Obstacle,t.ObjectMask.Obstacle),n.initBitmap(r.path),n.updatePosition(),n.setRotation(r.rotation),n}return __extends(i,e),i.prototype.initBitmap=function(t){var e=new egret.MovieClip(this.objmgr.moveFactory.generateMovieClipData("chainsaw"));e.gotoAndPlay(1==this.dir?"front":"side",-1),e.anchorOffsetX=e.width/2,e.anchorOffsetY=.7*e.height,e.scaleX=this.baseScale,e.scaleY=this.baseScale,this.addChild(e),this._movieClip=e},i.prototype.onTrigger=function(t){return this.objmgr.players.forEach(function(e){return e.body.id==t?(e.died(3),!0):void 0}),!0},i.prototype.updatePosition=function(t){void 0===t&&(t=0),e.prototype.updatePosition.call(this,t);var i=p2.vec2.dist(this.body.position,this.target);if(10>i){var o=this.target;this.target=this.source,this.source=o}var a=[this.target[0]-this.body.position[0],this.target[1]-this.body.position[1]],s=[];p2.vec2.normalize(s,a);var r=this.pVelocity;this.body.velocity=[s[0]*r,s[1]*r]},i}(t.FlyRect);t.MoveTraps=e,__reflect(e.prototype,"fly.MoveTraps")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s,r){var n=e.call(this)||this;return n.baseScale=t.FlyParam.TrapsBaseScale,n._nowstate="",n._lasttime=0,n._finished=!1,n.layerIndex=2,n.x=i+a/2,n.y=o+s/2,n.width=a,n.height=s,n.op=r,n.dir=r.dir||1,n.initBody({id:t.FlyConfig.getObstacleId(),mass:r.mass||1,type:r.type||p2.Body.DYNAMIC,fixedRotation:!0,position:[n.x,n.y],damping:r.damping||.8}),n.initShape(n.width,n.height),n.setGroupAndMask(t.ObjectGroup.Obstacle,t.ObjectMask.Obstacle),n.initBitmap(r.path),n.updatePosition(),n.setRotation(r.rotation),n}return __extends(i,e),i.prototype.initBitmap=function(t){var e=new egret.MovieClip(this.objmgr.stabFactory.generateMovieClipData("stab"));e.gotoAndPlay("hide",-1),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.scaleX=this.baseScale*this.width/e.width*this.dir,e.scaleY=this.baseScale*this.height/e.height,this.addChild(e),this._movieClip=e,this._nowstate="hide",this._lasttime=4,this._movieClip.addEventListener(egret.Event.COMPLETE,this.afterMovieClip,this)},i.prototype.afterMovieClip=function(){this._finished=!0},i.prototype.onTrigger=function(t){var e=this;return this.objmgr.players.forEach(function(i){return i.body.id==t&&"hide"!=e._nowstate?(i.died(3),!0):void 0}),!0},i.prototype.updatePosition=function(t){return void 0===t&&(t=0),e.prototype.updatePosition.call(this,t),this._lasttime>0?void(this._lasttime-=t):void this.nextState()},i.prototype.nextState=function(){"hide"==this._nowstate?(this._nowstate="emerge",this._movieClip.gotoAndPlay(this._nowstate,1)):"emerge"==this._nowstate&&this._finished?(this._nowstate="show",this._movieClip.gotoAndPlay(this._nowstate,-1),this._lasttime=t.FlyParam.traps_show_time,this._finished=!1):"show"==this._nowstate?(this._nowstate="retract",this._movieClip.gotoAndPlay(this._nowstate,1)):"retract"==this._nowstate&&this._finished&&(this._nowstate="hide",this._movieClip.gotoAndPlay(this._nowstate,-1),this._lasttime=t.FlyParam.traps_hide_time,this._finished=!1)},i}(t.FlyRect);t.Traps=e,__reflect(e.prototype,"fly.Traps")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.baseScale=t.FlyParam.PlayerBaseScale,r.step=1,r.reason=0,r.inoperable=0,r.isListener=!1,r.addPowerTime=0,r.dieReason=["die1","die1","die2","die2","die2","die2"],r.dir=1,r.weight="normal",r.nowState="front_stand_normal",r.layerIndex=5,r.x=i+a,r.y=o+a,r.radius=a,r.force=t.FlyParam.PlayerInitForce,r.power=t.FlyParam.PlayerInitPower,r.mass=t.FlyParam.PlayerInitMass,r.initBody({id:t.FlyConfig.getPlayerId(),mass:r.mass,type:p2.Body.DYNAMIC,fixedRotation:!0,position:[i,o],damping:.8}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.Player,t.ObjectMask.Player),r.initBitmap(),r.updatePosition(0),r.changePower(r.power),r}return __extends(i,e),i.prototype.updatePosition=function(t){void 0===t&&(t=0),e.prototype.updatePosition.call(this,t),this.inoperable>0&&(this.inoperable-=t),this.updateMovieClip(t),this.updatePowerFly(t)},i.prototype.updateMovieClip=function(e){var i=Math.abs(this.body.velocity[0]),o=Math.abs(this.body.velocity[1]);t.FlyParam.PlayerMoviePostfix[this.step];this.body.velocity[1]<0&&o>i?this.gotoAndPlay("black_move"):this.body.velocity[1]>0&&o>i?this.gotoAndPlay("front_move"):this.body.velocity[0]>0&&i>=o?this.gotoAndPlaySide("side_move",1):this.body.velocity[0]<0&&i>=o&&this.gotoAndPlaySide("side_move",-1),0==i&&0==o&&("black_move"==this.nowState||"black_stand"==this.nowState?this.gotoAndPlay("black_stand"):"front_move"==this.nowState||"front_stand"==this.nowState?this.gotoAndPlay("front_stand"):("side_move"==this.nowState||"side_stand"==this.nowState)&&this.gotoAndPlaySide("side_stand",this.dir))},i.prototype.updatePowerFly=function(t){this.addPowerTime>0&&16711680==this.powerText.textColor?(this.powerText.x=this.body.position[0]+20,this.powerText.y=this.body.position[1]-150+50*this.addPowerTime,this.powerText.alpha=this.addPowerTime/2,this.addPowerTime-=t):this.addPowerTime>0&&3381759==this.powerText.textColor?(this.powerText.x=this.body.position[0]+20,this.powerText.y=this.body.position[1]-50-50*this.addPowerTime,this.powerText.alpha=this.addPowerTime/2,this.addPowerTime-=t):this.powerText&&(this.powerText.visible=!1)},i.prototype.gotoAndPlay=function(e){var i=t.FlyParam.PlayerMoviePostfix[this.step];(this.nowState!=e||this.weight!=i)&&(this.movieClip.gotoAndPlay(e+i,-1),this.nowState=e,this.weight=i)},i.prototype.gotoAndPlaySide=function(e,i){var o=t.FlyParam.PlayerMoviePostfix[this.step];(this.nowState!=e||this.weight!=o||this.dir!=i)&&(this.movieClip.gotoAndPlay(e+o,-1),this.nowState=e,this.weight=o,this.dir=i,this.movieClip.scaleX=this.baseScale*t.FlyParam.PlayerTijiScale[this.step]*this.dir)},i.prototype.setVelocity=function(e,i){this.inoperable>0||(this.body.velocity=[e*t.FlyParam.PlayerVelScale[this.step],i*t.FlyParam.PlayerVelScale[this.step]])},i.prototype.initBitmap=function(){var t=new egret.MovieClip(this.objmgr.mcFactory.generateMovieClipData("playerState"));t.gotoAndPlay(this.nowState,-1),t.anchorOffsetX=t.width/2+8,t.anchorOffsetY=.8*t.height,this.addChild(t),this.movieClip=t;var t=new egret.MovieClip(this.objmgr.dieFactory.generateMovieClipData("playerDie"));t.visible=!1,t.anchorOffsetX=t.width/2+23,t.anchorOffsetY=t.height-20,this.addChild(t),this.dieMovieClip=t;var e=new egret.TextField;e.visible=!1,e.text="+10",e.size=60,e.textColor=16753920,this.addChild(e),this.powerText=e,this.dieMovieClip.addEventListener(egret.Event.COMPLETE,this.afterMovieClip,this)},i.prototype.addPower=function(t){this.addPowerMovie(t),this.changePower(this.power+t)},i.prototype.changePower=function(e){if(this.power=e,this.isListener&&this.objmgr.scene&&this.objmgr.scene.dispatchEventWith("ChangePower",!1,this.power),e<t.FlyParam.PlayerMinPower)return void this.died(1);for(var i=0;i<t.FlyParam.PlayerStep.length;++i)if(e<=t.FlyParam.PlayerStep[i])return void(this.step!=i&&(this.mass=t.FlyParam.PlayerInitMass*t.FlyParam.PlayerMassScale[i],this.force=t.FlyParam.PlayerInitForce*t.FlyParam.PlayerForceScale[i],this.circle.radius=this.radius*t.FlyParam.PlayerRadiusScale[i],this.circle.updateArea(),this.body.mass=this.mass,this.body.updateMassProperties(),this.movieClip.scaleX=this.baseScale*t.FlyParam.PlayerTijiScale[i]*this.dir,this.movieClip.scaleY=this.baseScale*t.FlyParam.PlayerTijiScale[i],this.dieMovieClip.scaleX=this.baseScale*t.FlyParam.PlayerTijiScale[i],this.dieMovieClip.scaleY=this.baseScale*t.FlyParam.PlayerTijiScale[i],this.step=i,this.changeRenderSize(this.circle.radius),this.updatePosition(0)));return e>t.FlyParam.PlayerMaxPower?void this.died(2):void 0},i.prototype.beginListener=function(){this.isListener=!0},i.prototype.reset=function(e,i){this.body.position=[e,i],this.body.velocity=[0,0],this.nowState="",this.weight="",this.step=-1,this.changePower(t.FlyParam.PlayerInitPower)},i.prototype.died=function(e){this.isDestroy||(this.isDestroy=!0,this.reason=e,this.dieMovieClip.visible=!0,this.movieClip.visible=!1,this.dieMovieClip.gotoAndPlay(this.dieReason[this.reason],1),this.isListener&&(this.objmgr.scene.stop(),t.SceneManager.inst().stopAllSound(),t.SceneManager.inst().playMusic("defeated.mp3",1)))},i.prototype.hit=function(t,e,i){0!=e&&this.addPower(e),this.setVelocity(t[0],t[1]),this.inoperable=i},i.prototype.win=function(){this.isDestroy||(this.isDestroy=!0,this.reason=0,this.isListener&&(this.objmgr.scene.stop(),t.SceneManager.inst().stopAllSound(),t.SceneManager.inst().playMusic("victory.mp3",1),this.afterMovieClip()))},i.prototype.afterMovieClip=function(){this.isListener?(t.SceneManager.inst().setPassTime(this.objmgr.scene.clickTime,this.reason),this.objmgr.scene.delPlayerFromWorld(this),this.objmgr.scene.isRunning=this.reason):this.reset(this.x,this.y)},i.prototype.addPowerMovie=function(t){this.addPowerTime=2,this.powerText.visible=!0,t>0?(this.powerText.text="+"+t,this.powerText.textColor=16711680):(this.powerText.text=""+t,this.powerText.textColor=3381759)},i}(t.FlyCircle);t.Player=e,__reflect(e.prototype,"fly.Player")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.baseScale=t.FlyParam.WindBaseScale,r._soundName="",r.layerIndex=4,r.x=i+a,r.y=o+a,r.radius=a,r.op=s,r.min=s.min||0,r.max=s.max||999,r.dir=s.dir||1,r._soundName=s.sound||"wind.mp3",r.initBody({id:t.FlyConfig.getPropertyId(),mass:1,type:p2.Body.DYNAMIC,fixedRotation:!0,position:[r.x,r.y]}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.Property,t.ObjectMask.Property),r.initBitmap(),r.updatePosition(),r}return __extends(i,e),i.prototype.initBitmap=function(){var t=new egret.MovieClip(this.objmgr.windFactory.generateMovieClipData("wind"));t.gotoAndPlay("play",-1),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.scaleX=this.baseScale*this.dir,t.scaleY=this.baseScale,this.addChild(t),this._movieClip=t},i.prototype.onTrigger=function(e){var i=this;return this.objmgr.players.forEach(function(o){if(o.body.id==e){if(i.min<o.body.mass&&o.body.mass<i.max){var a=[o.body.position[0]-i.x,o.body.position[1]-i.y],s=[];p2.vec2.normalize(s,a);var r=t.FlyParam.forceScale;o.setVelocity(s[0]*r,s[1]*r),o.inoperable=1}return!0}}),!0},i.prototype.updatePosition=function(i){void 0===i&&(i=0),e.prototype.updatePosition.call(this,i);var o=this.objmgr.scene.player,a=p2.vec2.dist(o.body.position,this.body.position);a<2*this.radius?t.SceneManager.inst().playSound(this._soundName,this):t.SceneManager.inst().stopSound(this._soundName,this)},i}(t.FlyCircle);t.WindTraps=e,__reflect(e.prototype,"fly.WindTraps")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.candyArray=null,r.baseScale=t.FlyParam.CandyBaseScale,r.layerIndex=2,r.x=i+a,r.y=o+a,r.radius=a,r.op=s,r.initBody({id:t.FlyConfig.getPropertyId(),mass:s.mass||1,type:s.type||p2.Body.DYNAMIC,fixedRotation:!0,position:[r.x,r.y],damping:s.damping||0}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.Property,t.ObjectMask.Property),r.initBitmap(s.path),r.updatePosition(),r.setRotation(s.rotation),r}return __extends(i,e),i.prototype.initBitmap=function(e){if(null!=e){var i=t.FlyTools.createBitmapByName(e);i.scaleX=this.baseScale*this.radius/i.width,i.scaleY=this.baseScale*this.radius/i.height,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,this.addChild(i)}},i.prototype.onTrigger=function(e){if(!this.isDestroy){this.isDestroy=!0;var o=this.op.power;if(this.objmgr.players.forEach(function(i){i.body.id==e&&i.addPower(o||t.FlyParam.candy_power)
}),null!=this.candyArray)return this.candyArray.onTrigger(this.x,this.y),!0;var a=this.op.delta;return a>0&&egret.setTimeout(function(e){if(t.ObjectManager.inst().scene==e){var o=new i(this.x-this.radius,this.y-this.radius,this.radius,this.op);this.objmgr.scene.addToWorld(o)}},this,1e3*a,this.objmgr.scene),!0}},i}(t.FlyCircle);t.Candy=e,__reflect(e.prototype,"fly.Candy")}(fly||(fly={}));var fly;!function(t){var e=function(){function t(){}return t}();__reflect(e.prototype,"candyModel");var i=function(){function i(){this.num=0,this.nowNum=0,this.models=[],this.objmgr=t.ObjectManager.inst()}return i.prototype.add=function(t){t.candyArray=this;var i=new e;i.x=t.x,i.y=t.y,i.radius=t.radius,i.op=t.op,i.use=!0,this.models.push(i),this.nowNum+=1},i.prototype.onTrigger=function(e,i){var o=this;if(this.models.forEach(function(t){t.x==e&&t.y==i&&(t.use=!1,o.nowNum-=1)}),this.nowNum<this.num&&this.nowNum<this.models.length){var a=0;do a=parseInt(""+Math.random()*this.models.length,10);while(this.models[a].use);var s=this.models[a];s.use=!0,this.nowNum+=1,egret.setTimeout(function(e){if(this.objmgr.scene==e){var i=new t.Candy(s.x-s.radius,s.y-s.radius,s.radius,s.op);i.candyArray=this,this.objmgr.scene.addToWorld(i)}},this,1e3*s.op.delta,this.objmgr.scene)}},i}();t.CandyArray=i,__reflect(i.prototype,"fly.CandyArray")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(i,o,a,s){var r=e.call(this)||this;return r.baseScale=t.FlyParam.PlaneBaseScale,r.layerIndex=5,r.x=i+a,r.y=o+a,r.radius=a,r.op=s,r.dir=s.dir||1,r.initBody({id:t.FlyConfig.getPropertyId(),mass:1,type:p2.Body.DYNAMIC,fixedRotation:!0,position:[r.x,r.y]}),r.initShape(r.radius),r.setGroupAndMask(t.ObjectGroup.Property,t.ObjectMask.Property),r.initBitmap(s.path),r.updatePosition(),r.setRotation(s.rotation),r}return __extends(i,e),i.prototype.initBitmap=function(e){if(null!=e){var i=t.FlyTools.createBitmapByName(e);i.scaleX=this.baseScale*this.dir,i.scaleY=this.baseScale,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,this.addChild(i)}},i.prototype.onTrigger=function(t){return this.objmgr.scene.player.win(),!0},i}(t.FlyCircle);t.Plane=e,__reflect(e.prototype,"fly.Plane")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.objmgr=t.ObjectManager.inst(),i.baseLayer=new egret.DisplayObjectContainer,i.uiLayer=new egret.DisplayObjectContainer,i.touchLayer=new egret.DisplayObjectContainer,i.layers=[],i.isRunning=-1,i.clickTime=0,i.lastPowerTime=0,i}return __extends(i,e),i.prototype.update=function(e){if(this.touchNode.isTouchMove){var i=this.touchNode.normal,o=t.FlyParam.forceScale;this.player.setVelocity(i[0]*o,i[1]*o)}else this.player.setVelocity(0,0);this.updatePower(e),this.updateScene(e),this.updateTime(e),this.objmgr.update(e)},i.prototype.getRandom=function(){var t=Math.random();return.2>t&&(t=4*-t-.2),.9*t},i.prototype.updatePower=function(e){this.lastPowerTime+=e,this.lastPowerTime>.5&&((0!=this.player.body.velocity[0]||0!=this.player.body.velocity[1])&&this.objmgr.players.forEach(function(e){e.changePower(e.power+.5*t.FlyParam.move_power)}),this.lastPowerTime-=.5)},i.prototype.updateScene=function(e){this.baseLayer.x=-this.player.body.position[0]*t.FlyParam.LayerScale+t.FlyConfig.stageWidth/2,this.baseLayer.y=-this.player.body.position[1]*t.FlyParam.LayerScale+t.FlyConfig.stageHeight/2},i.prototype.updateTime=function(t){this.clickTime+=t,this.time&&(this.time.text="当前用时: "+parseInt(""+10*this.clickTime,10)/10+" 秒")},i.prototype.initScene=function(t){this.tiledMapGroups=t,this.addChild(this.baseLayer),this.addChild(this.uiLayer),this.addChild(this.touchLayer),this.createBackgroud(),this.createWorld(),this.createScene(),this.createTouchLayer(),this.createUI()},i.prototype.createBackgroud=function(){this.baseLayer.scaleX=t.FlyParam.LayerScale,this.baseLayer.scaleY=t.FlyParam.LayerScale;var e=t.FlyTools.createBitmapByName("background_jpg");e.scaleX=t.FlyConfig.width/e.width,e.scaleY=t.FlyConfig.height/e.height,this.baseLayer.addChild(e);for(var i=0;6>i;++i){var o=new egret.DisplayObjectContainer;this.layers.push(o),this.baseLayer.addChild(o)}},i.prototype.createWorld=function(){var t=this.objmgr.world;this.world=t,egret.Ticker.getInstance().register(this.onTickWorld,this),t.on("postBroadphase",this.onBeginContact,this),t.on("endContact",this.onEndContact,this),t.on("postStep",this.onPostStep,this)},i.prototype.createScene=function(){var e=this;this.objmgr.scene=this,this.tiledMapGroups.forEach(function(i){i.isArray?t.BattleSceneFactory.createArray(e,i):i.group.forEach(function(i){t.BattleSceneFactory.createObject(e,i)})})},i.prototype.createTouchLayer=function(){var e=new t.BattleTouchNode(this,120);this.touchNode=e,this.touchLayer.addChild(this.touchNode)},i.prototype.createUI=function(){var e=new t.UIProgress;e.create(t.FlyParam.PlayerMaxPower,t.FlyParam.PlayerMinPower,t.FlyParam.PlayerInitPower),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.setPosition(e.width/2,e.height),this.addChild(e),this.progress=e;var i=t.FlyTools.createBitmapByName("thin_png");i.anchorOffsetX=i.width/2,i.anchorOffsetY=0,i.scaleX=.35,i.scaleY=.35,i.x=.3*(t.FlyConfig.stageWidth+30),i.y=40,this.addChild(i);var o=t.FlyTools.createBitmapByName("fat_png");o.anchorOffsetX=o.width/2,o.anchorOffsetY=0,o.scaleX=.2,o.scaleY=.2,o.x=.7*(t.FlyConfig.stageWidth-10),o.y=40,this.addChild(o),this.addEventListener("ChangePower",this.onChangePower,this);var a=new egret.TextField;a.text="当前关卡: "+t.SceneManager.inst().getMapId(),a.size=36,a.textColor=0,a.anchorOffsetX=0,a.anchorOffsetY=.5,a.x=5,a.y=e.height+25,this.addChild(a);var s=new egret.TextField;s.text="当前生命: "+t.SceneManager.inst().health,s.size=36,s.textColor=0,s.anchorOffsetX=0,s.anchorOffsetY=.5,s.x=5,s.y=e.height+a.height+40,this.addChild(s),this.text=s;var r=new egret.TextField;r.text="当前用时: "+this.clickTime+" 秒",r.size=36,r.textColor=0,r.anchorOffsetX=0,r.anchorOffsetY=.5,r.x=5,r.y=e.height+a.height+s.height+55,this.addChild(r),this.time=r},i.prototype.onChangePower=function(t){this.progress.changeValue(t.data)},i.prototype.onTickWorld=function(t){this.world.step(t/1e3),this.update(t/1e3)},i.prototype.onPostStep=function(){this.isRunning<0||(this.reset(),this.objmgr.reset(),t.SceneManager.inst().stopAllSound(),0==this.isRunning?t.SceneManager.inst().loadNext():t.SceneManager.inst().loadAgain(this.isRunning))},i.prototype.onBeginContact=function(t){for(var e=0;e<t.pairs.length;e+=2)this.onContactBegin(t.pairs[e],t.pairs[e+1])},i.prototype.onContactBegin=function(e,i){t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isProperty(i.id)?this.trigger(i.id,e.id):t.FlyConfig.isPlayer(i.id)&&t.FlyConfig.isProperty(e.id)?this.trigger(e.id,i.id):t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isObstacle(i.id)?this.trigger(i.id,e.id)||this.contactObstacleBegin(i.id,e.id):t.FlyConfig.isPlayer(i.id)&&t.FlyConfig.isObstacle(e.id)?this.trigger(e.id,i.id)||this.contactObstacleBegin(e.id,i.id):t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isBlock(i.id)?this.trigger(i.id,e.id)||this.contactObstacleBegin(i.id,e.id):t.FlyConfig.isPlayer(i.id)&&t.FlyConfig.isBlock(e.id)?this.trigger(e.id,i.id)||this.contactObstacleBegin(e.id,i.id):t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isAiPlayer(i.id)?this.trigger(i.id,e.id):t.FlyConfig.isPlayer(i.id)&&t.FlyConfig.isAiPlayer(e.id)?this.trigger(e.id,i.id):t.FlyConfig.isAiPlayer(e.id)&&t.FlyConfig.isObstacle(i.id)?this.triggerAi(i.id,e.id):t.FlyConfig.isAiPlayer(i.id)&&t.FlyConfig.isObstacle(e.id)?this.triggerAi(e.id,i.id):t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isPlayer(i.id)&&this.triggerPlayer(e.id,i.id)},i.prototype.onEndContact=function(t){this.onContactEnd(t.bodyA,t.bodyB)},i.prototype.onContactEnd=function(e,i){t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isObstacle(i.id)?this.contactObstacleEnd(i.id,e.id):t.FlyConfig.isPlayer(i.id)&&t.FlyConfig.isObstacle(e.id)?this.contactObstacleEnd(e.id,i.id):t.FlyConfig.isPlayer(e.id)&&t.FlyConfig.isBlock(i.id)?this.contactObstacleEnd(i.id,e.id):t.FlyConfig.isPlayer(i.id)&&t.FlyConfig.isBlock(e.id)&&this.contactObstacleEnd(e.id,i.id)},i.prototype.contactObstacleBegin=function(t,e){this.objmgr.sprites.forEach(function(i){return i.body.id==t?void i.onContactBegin(e):void 0})},i.prototype.contactObstacleEnd=function(t,e){this.objmgr.sprites.forEach(function(i){return i.body.id==t?void i.onContactEnd(e):void 0})},i.prototype.trigger=function(t,e){var i=this;return this.objmgr.sprites.forEach(function(o){if(o.body.id==t){var a=o.onTrigger(e);return o.isDestroy&&i.delFromWorld(o),a}}),!1},i.prototype.triggerAi=function(t,e){var i=this;return this.objmgr.sprites.forEach(function(o){(o.body.id==t||o.body.id==e)&&(o.destroy(),i.delFromWorld(o))}),!1},i.prototype.triggerPlayer=function(e,i){var o=null,a=null;if(this.objmgr.players.forEach(function(t){t.body.id==e?o=t:t.body.id==i&&(a=t)}),o&&a){var s=t.FlyTools.getDirect(o.body.position,a.body.position),r=t.FlyParam.forceScale;o.hit([s[0]*r,s[1]*r],0,1),o.hit([-s[0]*r,-s[1]*r],0,1)}},i.prototype.addPlayerToWorld=function(t){var e=this,i=t.layerIndex||0;this.world.addBody(t.body),t.body.displays.forEach(function(t){e.layers[i].addChild(t)}),this.objmgr.addPlayer(t)},i.prototype.delPlayerFromWorld=function(t){var e=this,i=t.layerIndex||0;t.body.displays.forEach(function(t){e.layers[i].removeChild(t)}),this.world.removeBody(t.body)},i.prototype.addToWorld=function(t){var e=this,i=t.layerIndex||0;this.world.addBody(t.body),t.body.displays.forEach(function(t){e.layers[i].addChild(t)}),this.objmgr.addSprite(t)},i.prototype.delFromWorld=function(t){var e=this,i=t.layerIndex||0;t.body.displays.forEach(function(t){e.layers[i].removeChild(t)}),this.world.removeBody(t.body)},i.prototype.addImage=function(t){this.layers[0].addChild(t)},i.prototype.reset=function(){egret.Ticker.getInstance().unregister(this.onTickWorld,this),this.removeEventListener("ChangePower",this.onChangePower,this),this.world.off("postBroadphase",this.onBeginContact),this.world.off("endContact",this.onEndContact),this.world.off("postStep",this.onPostStep)},i.prototype.stop=function(){this.touchNode.setTouchEnable(!1)},i}(egret.DisplayObjectContainer);t.BattleScene=e,__reflect(e.prototype,"fly.BattleScene")}(fly||(fly={}));var fly;!function(t){var e=function(){function t(){}return t}();t.BattleSceneContact=e,__reflect(e.prototype,"fly.BattleSceneContact")}(fly||(fly={}));var fly;!function(t){var e=function(){function e(){}return e.createObject=function(e,i){if("player"==i.type){var o=new t.Player(i.x,i.y,i.width/2);e.addPlayerToWorld(o),"self"==i.name&&(e.player=o,o.beginListener())}else if("wall"==i.type){var a=new t.Wall(i.x,i.y,i.width,i.height);e.addToWorld(a)}else if("blockrect"==i.type){var s=new t.BlockRect(i.x,i.y,i.width,i.height,{path:i.params.path,type:Number(i.params.type),mass:Number(i.params.mass),damping:Number(i.params.damping),rotation:Number(i.params.rotation)});e.addToWorld(s)}else if("blockcircle"==i.type){var s=new t.BlockCircle(i.x,i.y,i.width/2,{path:i.params.path,type:Number(i.params.type),mass:Number(i.params.mass),damping:Number(i.params.damping),rotation:Number(i.params.rotation)});e.addToWorld(s)}else if("candy"==i.type){var r=new t.Candy(i.x,i.y,i.width/2,{path:i.params.path,type:Number(i.params.type),rotation:Number(i.params.rotation),delta:Number(i.params.delta),power:Number(i.params.power)});e.addToWorld(r)}else if("plane"==i.type){var n=new t.Plane(i.x,i.y,i.width/2,{path:i.params.path,rotation:Number(i.params.rotation),dir:Number(i.params.dir)});e.addToWorld(n)}else if("traps"==i.type){var h=new t.Traps(i.x,i.y,i.width,i.height,{path:i.params.path,type:Number(i.params.type),rotation:Number(i.params.rotation),dir:Number(i.params.dir)});e.addToWorld(h)}else if("weighttraps"==i.type){var h=new t.WeightTraps(i.x,i.y,i.width/2,{path:i.params.path,type:Number(i.params.type),rotation:Number(i.params.rotation),min:Number(i.params.min),max:Number(i.params.max)});e.addToWorld(h)}else if("windtraps"==i.type){var h=new t.WindTraps(i.x,i.y,i.width/2,{type:Number(i.params.type),min:Number(i.params.min),max:Number(i.params.max),sound:Number(i.params.sound),dir:Number(i.params.dir)});e.addToWorld(h)}else if("aitraps"==i.type){var h=new t.AiTraps(i.x,i.y,i.width/2,{path:i.params.path,damping:Number(i.params.damping),rotation:Number(i.params.rotation),pRadius:Number(i.params.radius),pVelocity:Number(i.params.velocity),sound:Number(i.params.sound)});e.addToWorld(h)}else if("weightblock"==i.type){var s=new t.WeightBlock(i.x,i.y,i.width,i.height,{path:i.params.path,rotation:Number(i.params.rotation),min:Number(i.params.min),max:Number(i.params.max)});e.addToWorld(s)}else if("weightmonster"==i.type){var s=new t.WeightMonster(i.x,i.y,i.width,i.height,{path:i.params.path,rotation:Number(i.params.rotation),min:Number(i.params.min),max:Number(i.params.max),sound:Number(i.params.sound),dir:Number(i.params.dir)});e.addToWorld(s)}else if("movetraps"==i.type){var h=new t.MoveTraps(i.x,i.y,i.width,i.height,{path:i.params.path,type:Number(i.params.type),rotation:Number(i.params.rotation),tx:Number(i.params.tx),ty:Number(i.params.ty),dir:Number(i.params.dir),pVelocity:Number(i.params.velocity)});e.addToWorld(h)}else if("image"==i.type){var l=t.FlyTools.createBitmapByName(i.params.path);l.x=i.x+l.width/2,l.y=i.y+l.height/2,l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.scaleX=Number(i.params.scale||1),l.scaleY=Number(i.params.scale||1),e.addImage(l)}},e.createArray=function(e,i){var o=new t.CandyArray;o.num=i.num,i.group.forEach(function(i){var a=new t.Candy(i.x,i.y,i.width/2,{path:i.params.path,type:Number(i.params.type),rotation:Number(i.params.rotation),delta:Number(i.params.delta),power:Number(i.params.power)});e.addToWorld(a),o.add(a)})},e}();t.BattleSceneFactory=e,__reflect(e.prototype,"fly.BattleSceneFactory")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(t,i){var o=e.call(this)||this;return o.direct=[],o.normal=[],o.isTouchMove=!1,o.parentNode=t,o.maxDist=i,o.createTouchLayer(),o}return __extends(i,e),i.prototype.setTouchEnable=function(t){this.background.touchEnabled=t,t||this.onTouchEnd(null)},i.prototype.createTouchLayer=function(){var e=new egret.Shape;e.graphics.beginFill(5592405,1),e.graphics.drawRect(0,0,t.FlyConfig.stageWidth,t.FlyConfig.stageHeight),e.graphics.endFill(),this.background=e,this.parentNode.addChildAt(e,0),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchEnd,this),e.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this);var i=t.FlyTools.createBitmapByName("virtual_background_png");i.alpha=0,i.scaleX=1.2,i.scaleY=1.2,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,this.virtualBg=i,this.parentNode.addChildAt(i,100);var o=t.FlyTools.createBitmapByName("virtual_button_png");o.alpha=0,o.scaleX=.5,o.scaleY=.5,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,this.virtualBtn=o,this.parentNode.addChildAt(o,101)},i.prototype.onTouchBegin=function(t){this.virtualBg.x=450,this.virtualBg.y=1300,this.virtualBg.alpha=.5,this.virtualBtn.x=450,this.virtualBtn.y=1300,this.virtualBtn.alpha=.5},i.prototype.onTouchEnd=function(t){this.virtualBg.alpha=0,this.virtualBtn.alpha=0,this.isTouchMove=!1},i.prototype.onTouchMove=function(t){var e=[this.virtualBg.x,this.virtualBg.y],i=[t.stageX,t.stageY],o=[i[0]-e[0],i[1]-e[1]];p2.vec2.normalize(this.normal,o),this.normal=this.normal8dir(this.normal),this.direct[0]=this.normal[0]*this.maxDist,this.direct[1]=this.normal[1]*this.maxDist,this.virtualBtn.x=e[0]+this.direct[0],this.virtualBtn.y=e[1]+this.direct[1],this.isTouchMove=!0},i.prototype.normal8dir=function(t){var e=[0,0],i=Math.sqrt(2)/2,o=Math.acos(t[0])/Math.PI*180;return t[1]<0&&(o=360-o),e=o>=337.5||22.5>o?[1,0]:o>=292.5?[i,-i]:o>=247.5?[0,-1]:o>=202.5?[-i,-i]:o>=157.5?[-1,0]:o>=112.5?[-i,i]:o>=67.5?[0,1]:o>=22.5?[i,i]:t},i}(egret.DisplayObjectContainer);t.BattleTouchNode=e,__reflect(e.prototype,"fly.BattleTouchNode")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.music=new t.FlyMusic,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeStage,i),i}return __extends(i,e),i.prototype.onAddToStage=function(){this.music.playObject("start.mp3"),this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.graphics.endFill();var e=this.stage.stageWidth,i=this.stage.stageHeight,o=new egret.Bitmap;o.texture=RES.getRes("title_png"),o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.x=e/2,o.y=170,o.scaleX=o.scaleY=2,this.addChild(o),this.title_bg=o;var a=new egret.MovieClip(t.ObjectManager.inst().winFactory.generateMovieClipData("Win"));a.gotoAndPlay("play",-1),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=e/2-10,a.y=i/2-270,a.scaleX=a.scaleY=2,this.addChild(a);var s=t.FlyTools.createBitmapByName("playBtn_png");s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.x=e/2,s.y=a.y+2*a.height+150,s.scaleX=s.scaleY=2,this.addChild(s),this.enterGameBtn=s,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchClick,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCancel,this)},i.prototype.removeStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)},i.prototype.onTouchBegin=function(t){this.enterGameBtn.hitTestPoint(t.localX,t.localY)&&(this.enterGameBtn.scaleX=this.enterGameBtn.scaleY=1.8)},i.prototype.onTouchClick=function(e){if(this.enterGameBtn.scaleX=this.enterGameBtn.scaleY=2,this.enterGameBtn.hitTestPoint(e.localX,e.localY)){this.music.stop();var i=this.parent;i.removeChild(this);var o=t.SceneManager.inst();o.init(i,i.stage.stageWidth,i.stage.stageHeight),o.load(1)}},i.prototype.onTouchCancel=function(t){this.enterGameBtn.scaleX=this.enterGameBtn.scaleY=2},i}(egret.Sprite);t.EnterGameScene=e,__reflect(e.prototype,"fly.EnterGameScene")}(fly||(fly={}));var fly;!function(t){var e=function(){function e(){this.delayKeys=[],this.sprites=[],this.players=[]}return e.inst=function(){return this.isInit||(this.obj.init(),this.isInit=!0),this.obj},e.prototype.init=function(){this.loadMovieClip()},e.prototype.update=function(t){for(var e=this.sprites.length,i=0;e>i;)this.sprites[i].isDestroy?(--e,this.sprites[i].indexOf=-1,this.sprites[i]=this.sprites[e],this.sprites[i].indexOf=i,this.sprites.pop()):(this.sprites[i].updatePosition(t),++i);for(var o=this.players.length,i=0;o>i;)this.players[i].isDestroy?(--o,this.players[i].indexOf=-1,this.players[i]=this.players[o],this.players[i].indexOf=i,this.players.pop()):(this.players[i].updatePosition(t),++i)},e.prototype.addSprite=function(t){t.indexOf=this.sprites.length,this.sprites.push(t)},e.prototype.delSprite=function(t){t.isDestroy=!0},e.prototype.addPlayer=function(t){t.indexOf=this.players.length,this.players.push(t)},e.prototype.delPlayer=function(t){t.isDestroy=!0},e.prototype.loadMovieClip=function(){var t=RES.getRes("playerNormalMode_json"),e=RES.getRes("playerNormalMode_png"),i=new egret.MovieClipDataFactory(t,e);this.mcFactory=i;var t=RES.getRes("playerDie_json"),e=RES.getRes("playerDie_png"),o=new egret.MovieClipDataFactory(t,e);this.dieFactory=o;var t=RES.getRes("wind_json"),e=RES.getRes("wind_png"),a=new egret.MovieClipDataFactory(t,e);this.windFactory=a;var t=RES.getRes("dog_json"),e=RES.getRes("dog_png"),s=new egret.MovieClipDataFactory(t,e);this.dogFactory=s;var t=RES.getRes("monsterWall_json"),e=RES.getRes("monsterWall_png"),r=new egret.MovieClipDataFactory(t,e);this.monFactory=r;var t=RES.getRes("player_win_json"),e=RES.getRes("player_win_png"),n=new egret.MovieClipDataFactory(t,e);this.winFactory=n;var t=RES.getRes("ice_json"),e=RES.getRes("ice_png"),h=new egret.MovieClipDataFactory(t,e);this.iceFactory=h;var t=RES.getRes("chainsaw_json"),e=RES.getRes("chainsaw_png"),l=new egret.MovieClipDataFactory(t,e);this.moveFactory=l;var t=RES.getRes("stab_json"),e=RES.getRes("stab_png"),d=new egret.MovieClipDataFactory(t,e);this.stabFactory=d;var c=new p2.World;c.gravity=[0,0],c.applyDamping=!0,c.sleepMode=p2.World.BODY_SLEEPING,this.world=c},e.prototype.reset=function(){this.scene=null,this.sprites=[],this.players=[],this.world.clear(),this.world.gravity=[0,0],this.world.applyDamping=!0,this.world.sleepMode=p2.World.BODY_SLEEPING,t.FlyConfig.reset()},e.isInit=!1,e.obj=new e,e}();t.ObjectManager=e,__reflect(e.prototype,"fly.ObjectManager")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.dieReason=["die1","die1","die2","die2","die2","die2"],t}return __extends(i,e),i.prototype.initScene=function(e,i){this.reason=e,this.mgr=i,this.objmgr=t.ObjectManager.inst();var o=t.FlyTools.createBitmapByName("background_jpg");o.scaleX=t.FlyConfig.width/o.width,o.scaleY=t.FlyConfig.height/o.height,this.addChild(o);var a=new egret.Bitmap;a.texture=RES.getRes("title_png"),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=t.FlyConfig.stageWidth/2,a.y=170,a.scaleX=a.scaleY=2,this.addChild(a);var s=[];s=0==e?this.createWinScene():e>0?this.createLoseScene(e):this.createPassScene();var r=this.movieclip.y+2*this.movieclip.height+30,n=new egret.TextField;n.text=s[0],n.size=48,n.textColor=0,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=t.FlyConfig.stageWidth/2,n.y=r,this.addChild(n),r=r+n.height+30;var n=new egret.TextField;0>e?n.text="最佳用时: "+parseInt(""+10*this.mgr.getPassTimeAll(),10)/10+"秒":0==e?n.text="本次用时: "+parseInt(""+10*this.mgr.getLastTime(),10)/10+"秒(最短用时: "+parseInt(""+10*this.mgr.getPassTime(),10)/10+"秒)":n.text="当前剩余生命: "+this.mgr.health,n.size=48,n.textColor=0,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=t.FlyConfig.stageWidth/2,n.y=r,this.addChild(n);var h=t.FlyTools.createBitmapByName("erweima_png");h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,h.x=t.FlyConfig.stageWidth/2,h.y=n.y+2*n.height+220,h.scaleX=h.scaleY=1.5,h.visible=!1,this.addChild(h),this.erweima=h;var l=t.FlyTools.createBitmapByName(s[1]);l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.x=t.FlyConfig.stageWidth/2,l.y=n.y+2*n.height+100,l.scaleX=l.scaleY=2,this.addChild(l),this.enterGameBtn=l;var d=t.FlyTools.createBitmapByName("shareBtn_png");d.anchorOffsetX=d.width/2,d.anchorOffsetY=d.height/2,d.x=t.FlyConfig.stageWidth/2,d.y=this.enterGameBtn.y+this.enterGameBtn.height+150,d.scaleX=d.scaleY=2,this.addChild(d),this.shareGameBtn=d,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchClick,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCancel,this)},i.prototype.createWinScene=function(){var e=new egret.MovieClip(this.objmgr.winFactory.generateMovieClipData("Win"));return e.gotoAndPlay("play",-1),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=t.FlyConfig.stageWidth/2-10,e.y=t.FlyConfig.stageHeight/2-270,e.scaleX=e.scaleY=2,this.addChild(e),this.movieclip=e,["多吃少运动，胖的真可爱！","nextBtn_png"]},i.prototype.createLoseScene=function(e){var i=null;return 4==e?(i=new egret.MovieClip(this.objmgr.iceFactory.generateMovieClipData("ice")),i.gotoAndPlay("drop",-1),i.anchorOffsetY=.3*i.height):(i=new egret.MovieClip(this.objmgr.dieFactory.generateMovieClipData("playerDie")),i.gotoAndPlay(this.dieReason[e],-1),i.anchorOffsetY=.5*i.height),i.anchorOffsetX=i.width/2,i.x=t.FlyConfig.stageWidth/2-10,i.y=t.FlyConfig.stageHeight/2-270,i.scaleX=i.scaleY=2,this.addChild(i),this.movieclip=i,["大风大雨也刮不跑你！","againBtn_png"]},i.prototype.createPassScene=function(){var e=new egret.MovieClip(this.objmgr.winFactory.generateMovieClipData("Win"));e.gotoAndPlay("play",-1),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=t.FlyConfig.stageWidth/2-10,e.y=t.FlyConfig.stageHeight/2-270,e.scaleX=e.scaleY=2,this.addChild(e),this.movieclip=e;var i="我死了"+t.SceneManager.inst().health+"次完成所有关卡！不服来战！";return 0==t.SceneManager.inst().health&&(i="不是一家胖人，不进一家胖门！"),[i,"backBtn_png"]},i.prototype.onTouchBegin=function(t){this.enterGameBtn.hitTestPoint(t.localX,t.localY)?this.enterGameBtn.scaleX=this.enterGameBtn.scaleY=1.8:this.shareGameBtn.hitTestPoint(t.localX,t.localY)&&(this.shareGameBtn.scaleX=this.shareGameBtn.scaleY=1.8)},i.prototype.onTouchClick=function(t){this.enterGameBtn.scaleX=this.enterGameBtn.scaleY=2,this.shareGameBtn.scaleX=this.shareGameBtn.scaleY=2,this.enterGameBtn.hitTestPoint(t.localX,t.localY)?this.mgr.onClickBtn(this.reason):this.shareGameBtn.hitTestPoint(t.localX,t.localY)&&this.mgr.onClickShare()},i.prototype.onTouchCancel=function(t){this.enterGameBtn.scaleX=this.enterGameBtn.scaleY=2,this.shareGameBtn.scaleX=this.shareGameBtn.scaleY=2},i}(egret.DisplayObjectContainer);t.PassScene=e,__reflect(e.prototype,"fly.PassScene")}(fly||(fly={}));var fly;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._mapId=0,t._maxId=5,t._tiledMapObjs=[],t.times=[],t}return __extends(i,e),i.inst=function(){return this.scenemgr},i.prototype.init=function(t,e,i){this._parent=t,this._width=e,this._height=i,this.health=2,this.createMusicAndSound()},i.prototype.getMapId=function(){return this._mapId},i.prototype.load=function(t){this.loadTiledMap(t)},i.prototype.loadNext=function(){this.reset(),this._mapId+1<this._maxId?this.createPassScene(0):this.createPassScene(-1)},i.prototype.loadAgain=function(t){this.health-=1,this.reset(),this.createPassScene(t)},i.prototype.loadNow=function(){var e=new t.BattleScene;e.initScene(this._tiledMapObjs),this._parent.addChild(e),this.playMusic("bgm"+this._mapId+".mp3")},i.prototype.onClickBtn=function(e){if(this._passScene&&(this._parent.removeChild(this._passScene),this._passScene=null),e>0)this.loadNow();else if(0==e)this.loadTiledMap(this._mapId+1);else{this.reset();var i=new t.EnterGameScene;this._parent.addChild(i)}},i.prototype.onClickShare=function(){this._passScene.erweima.visible=!0,this._passScene.enterGameBtn.visible=!1,this._passScene.shareGameBtn.visible=!1;var e=new egret.RenderTexture,i=new egret.Rectangle(0,0,t.FlyConfig.stageWidth,t.FlyConfig.stageHeight);e.drawToTexture(this._passScene,i);var o=document.getElementById("divImage"),a=document.getElementById("shareImage");a.src=e.toDataURL("image/png"),o.style.display="block",this._passScene.erweima.visible=!1,this._passScene.enterGameBtn.visible=!0,this._passScene.shareGameBtn.visible=!0},i.prototype.loadTiledMap=function(t){this._mapId=t,this._url="resource/map/battle"+t+".tmx",this._request=new egret.HttpRequest,this._request.addEventListener(egret.Event.COMPLETE,this.onMapComplete,this),this._request.addEventListener(egret.ProgressEvent.PROGRESS,this.onMapProgress,this),this._request.open(this._url,egret.HttpMethod.GET),this._request.send(),null==this._loadingView&&(this._loadingView=new UILoading),this._loadingView.x=this._parent.stage.stageWidth/2-200,this._loadingView.y=this._parent.stage.stageHeight/2,this._loadingView.scaleX=2,this._loadingView.scaleY=2,this._parent.addChild(this._loadingView)},i.prototype.onMapProgress=function(t){this._loadingView.setProgress(t.bytesLoaded,t.bytesTotal)},i.prototype.onMapComplete=function(e){this._request.removeEventListener(egret.Event.COMPLETE,this.onMapComplete,this),this._request.removeEventListener(egret.ProgressEvent.PROGRESS,this.onMapProgress,this);var i=egret.XML.parse(e.currentTarget.response);t.FlyConfig.width=i.$width*i.$tilewidth,t.FlyConfig.height=i.$height*i.$tileheight,t.FlyConfig.stageWidth=this._width,t.FlyConfig.stageHeight=this._height;var o=[];i.children.forEach(function(e){var i=new t.TiledMapGroup,a=e;a.children.forEach(function(e){var o=e;if("object"==o.localName){var a=new t.TiledMapObject;a.name=o.$name,a.type=o.$type,a.x=Number(o.$x),a.y=Number(o.$y),a.width=Number(o.$width),a.height=Number(o.$height),o.children.forEach(function(t){var e=t;e.children.forEach(function(t){a.params[t.$name]=t.$value})}),i.push(a)}else"properties"==o.localName&&o.children.forEach(function(t){var e=t;"type"==e.$name?i.isArray="candy_array"==e.$value:"num"==e.$name&&(i.num=Number(e.$value||0))})}),o.push(i)}),this._parent.removeChild(this._loadingView),this._tiledMapObjs=o,this.loadNow()},i.prototype.createMusicAndSound=function(){var e=new t.FlyMusic;this.music=e;var i=new t.FlyMusic;this.sound=i},i.prototype.playSound=function(t,e,i){void 0===i&&(i=0),null==this.soundObj&&(this.sound.playObject(t,i),this.soundObj=e)},i.prototype.stopSound=function(t,e){this.soundObj==e&&(this.sound.stop(),this.soundObj=null)},i.prototype.stopAllSound=function(){this.music.stop(),this.sound.stop(),this.soundObj=null},i.prototype.playMusic=function(t,e){void 0===e&&(e=0),this.music.playObject(t,e)},i.prototype.reset=function(){this._parent.removeChildren(),this.music.stop(),this.sound.stop(),this.soundObj=null},i.prototype.createPassScene=function(e){var i=new t.PassScene;i.initScene(e,this),this._parent.addChild(i),this._passScene=i},i.prototype.setPassTime=function(t,e){this.lastTime=t,0>=e&&this.times.length<this._mapId?this.times.push(t):0>=e&&this.times[this._mapId-1]>t&&(this.times[this._mapId-1]=t)},i.prototype.getLastTime=function(){return this.lastTime},i.prototype.getPassTime=function(){return this.times[this._mapId-1]},i.prototype.getPassTimeAll=function(){var t=0;return this.times.forEach(function(e){t+=e}),t},i.scenemgr=new i,i}(egret.DisplayObject);t.SceneManager=e,__reflect(e.prototype,"fly.SceneManager")}(fly||(fly={}));var fly;!function(t){var e=function(){function t(){this.group=[],this.isArray=!1,this.num=1}return t.prototype.push=function(t){this.group.push(t)},t}();t.TiledMapGroup=e,__reflect(e.prototype,"fly.TiledMapGroup")}(fly||(fly={}));var fly;!function(t){var e=function(){function t(){this.params={}}return t}();t.TiledMapObject=e,__reflect(e.prototype,"fly.TiledMapObject")}(fly||(fly={}));var UILoading=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.bar_bg=new egret.Bitmap,this.bar_bg.texture=RES.getRes("bar_bg_png"),this.addChild(this.bar_bg),this.bar=new egret.Bitmap,this.bar.texture=RES.getRes("load_bar_png"),this.addChild(this.bar),this.bar_mask=new egret.Bitmap,this.bar_mask.texture=RES.getRes("load_mask_png"),this.bar_width=this.bar_mask.width,this.bar_mask.width=1,this.addChild(this.bar_mask),this.bar.mask=this.bar_mask,this.textField=new egret.TextField,this.textField.anchorOffsetX=this.textField.width/2,this.textField.anchorOffsetY=this.textField.height/2,this.textField.textAlign="center",this.textField.scaleX=.68,this.textField.scaleY=.68,this.textField.x=110,this.textField.y=6,this.addChild(this.textField);var t=RES.getRes("loading_amin_json"),e=RES.getRes("loading_amin_png"),i=new egret.MovieClipDataFactory(t,e);this.loadAmin=new egret.MovieClip(i.generateMovieClipData("loading")),this.loadAmin.gotoAndPlay("start",-1),this.addChild(this.loadAmin),this.loadAmin.y=-60,this.loadAmin.x=180},e.prototype.setProgress=function(t,e){this.textField.text=t+"/"+e,this.bar_mask.width=t/e*this.bar_width},e}(egret.Sprite);__reflect(UILoading.prototype,"UILoading");var fly;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.create=function(e,i,o){var a=t.FlyConfig.stageWidth-10,s=t.FlyTools.createBitmapByName("progress_bar_background_png");s.anchorOffsetX=0,s.anchorOffsetY=s.height/2,s.width=a,s.height=2*s.height,this.addChild(s),this.bg=s;var r=t.FlyTools.createBitmapByName("progress_bar_png");r.anchorOffsetX=0,r.anchorOffsetY=r.height/2,r.width=a,r.height=2*r.height+10,this.addChild(r),this.fr=r;
var n=t.FlyTools.createBitmapByName("progress_bar_frame_png");n.anchorOffsetX=0,n.anchorOffsetY=n.height/2,n.width=a,n.height=2*n.height,this.addChild(n),this.mk=n,this.max=e,this.min=i,this.now=o,this.changeValue(o)},i.prototype.setPosition=function(t,e){this.bg.x=t+5,this.bg.y=e,this.fr.x=t+10,this.fr.y=e+2,this.mk.x=t+5,this.mk.y=e},i.prototype.changeValue=function(t){var e=t;e=Math.min(this.max,e),e=Math.max(this.min,e),this.now=e;var i=(e-this.min)/(this.max-this.min);this.fr.scaleX=i},i}(egret.DisplayObjectContainer);t.UIProgress=e,__reflect(e.prototype,"fly.UIProgress")}(fly||(fly={}));